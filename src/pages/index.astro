---
// Internal imports
import BaseLayout from '@layouts/BaseLayout.astro';
---

<BaseLayout
  title="Home"
  description="Connecting filmmakers across Western North Carolina. Find festivals, crew directories, events, production companies, and resources in Asheville and beyond."
>
  <h1>Welcome to AVL Film</h1>

  <p class="intro">AVL Film exists to nurture the independent film scene in Asheville and throughout Western North Carolina by creating pathways for filmmakers to collaborate, connect, and build community.</p>

  <div class="features-grid">
    <a href="/festivals" class="feature-card">
      <div class="feature-icon">üé¨</div>
      <h3>Film Festivals</h3>
      <p>Discover festivals around Asheville, from local showcases to major regional events.</p>
    </a>

    <a href="/directory" class="feature-card">
      <div class="feature-icon">üë•</div>
      <h3>Filmmaker Directory</h3>
      <p>Connect with local filmmakers and industry professionals in the area.</p>
    </a>

    <a href="/calendar" class="feature-card">
      <div class="feature-icon">üìÖ</div>
      <h3>Event Calendar</h3>
      <p>Stay up to date with film events, meetups, and workshops happening locally.</p>
    </a>

    <a href="/production" class="feature-card">
      <div class="feature-icon">üé•</div>
      <h3>Production Companies</h3>
      <p>Browse video production companies and music/sound design services in WNC.</p>
    </a>

    <a href="/resources" class="feature-card">
      <div class="feature-icon">üìö</div>
      <h3>Resources</h3>
      <p>Find film schools, theaters, equipment rentals, casting calls, and everything you need to make films.</p>
    </a>

    <div class="feature-card newsletter-card">
      <div class="feature-icon">‚úâÔ∏è</div>
      <h3>Stay Connected</h3>
      <p>Get updates on the film community.</p>

      <form id="newsletter-form" class="newsletter-form">
        <input
          type="email"
          id="email"
          name="email"
          placeholder="Enter your email"
          required
          autocomplete="email"
        />
        <input
          type="text"
          name="website"
          id="website"
          autocomplete="off"
          tabindex="-1"
          aria-hidden="true"
        />
        <button type="submit" class="btn-primary subscribe-btn">Subscribe</button>
        <div id="message" class="alert message"></div>
      </form>
    </div>
  </div>

  <div id="curator-feed-default-feed-layout">
    <a href="https://curator.io" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a>
  </div>

  <script is:inline type="text/javascript">
    (function(){
    var i,e,d=document,s="script";i=d.createElement("script");i.async=1;
    i.src="https://cdn.curator.io/published/d5bcd531-5f22-498d-9491-8eb7cd4f0793.js";
    e=d.getElementsByTagName(s)[0];e.parentNode.insertBefore(i, e);
    })();
  </script>
</BaseLayout>

<style>
  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin: 3rem 0;
  }

  .feature-card {
    padding: 2rem;
    background: #ffffff;
    border-radius: var(--radius-xl);
    border: 2px solid var(--color-border);
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .feature-card:hover {
    border-color: var(--color-primary);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
  }

  .feature-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    filter: grayscale(0.3);
    transition: filter 0.3s;
  }

  .feature-card:hover .feature-icon {
    filter: grayscale(0);
  }

  .feature-card h3 {
    margin: 0 0 0.75rem 0;
    color: #1f2937;
    font-size: 1.3rem;
    font-weight: 600;
  }

  .feature-card p {
    margin: 0;
    color: #6b7280;
    line-height: 1.6;
    font-size: 0.95rem;
  }

  .newsletter-card {
    border-color: var(--color-primary);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.03) 0%, rgba(118, 75, 162, 0.03) 100%);
  }

  .newsletter-card:hover {
    border-color: var(--color-primary-dark);
  }

  .newsletter-form {
    width: 100%;
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .newsletter-form input[type="email"] {
    padding: 0.6rem 0.875rem;
    font-size: 0.9rem;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .newsletter-form input[name="website"] {
    position: absolute;
    left: -9999px;
    width: 0;
    height: 0;
    opacity: 0;
    pointer-events: none;
  }

  .subscribe-btn {
    width: 100%;
    padding: 0.6rem 1.25rem;
    font-size: 0.9rem;
    border-radius: var(--radius-lg);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  }

  .subscribe-btn:hover {
    transform: translateY(-1px);
  }

  .subscribe-btn:active {
    transform: translateY(0);
  }

  .message {
    display: none;
    padding: 0.65rem;
    font-size: 0.85rem;
    text-align: left;
  }

  .message.alert-success,
  .message.alert-error {
    display: block;
  }

  :global(.crt-filter-label) {
    display: none !important;
  }

  @media (max-width: 768px) {
    .features-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
      margin: 2rem 0;
    }

    .feature-card {
      padding: 1.5rem;
    }

    .feature-icon {
      font-size: 2.5rem;
    }

    .feature-card h3 {
      font-size: 1.15rem;
    }

    .newsletter-form {
      margin-top: 1rem;
    }

    .subscribe-btn {
      width: 100%;
    }
  }
</style>

<script>
  import { showFormMessage } from '@lib/form-utils';

  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const emailInput = document.getElementById('email') as HTMLInputElement;
  const messageDiv = document.getElementById('message') as HTMLDivElement;
  const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = emailInput.value.trim();

    if (!email) {
      showFormMessage(messageDiv, 'Please enter your email address', 'error');
      return;
    }

    // Disable button and show loading state
    submitBtn.disabled = true;
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Subscribing...';

    try {
      const websiteInput = document.getElementById('website') as HTMLInputElement;
      const response = await fetch('/api/newsletter/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email,
          website: websiteInput.value
        }),
      });

      const data = await response.json();

      if (response.ok) {
        showFormMessage(messageDiv, data.message || 'Successfully subscribed!', 'success');
        messageDiv.className = 'alert message alert-success'; // Maintain alert- prefix
        emailInput.value = '';
        // Auto-hide success messages after 5 seconds
        setTimeout(() => {
          messageDiv.className = 'alert message';
        }, 5000);
      } else {
        showFormMessage(messageDiv, data.error || 'Failed to subscribe. Please try again.', 'error');
        messageDiv.className = 'alert message alert-error'; // Maintain alert- prefix
      }
    } catch (error) {
      console.error('Subscription error:', error);
      showFormMessage(messageDiv, 'Something went wrong. Please try again later.', 'error');
      messageDiv.className = 'alert message alert-error'; // Maintain alert- prefix
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>
