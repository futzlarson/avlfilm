---
/**
 * Client-side Rollbar error tracking
 * Include this component in your base layout to capture client-side errors
 */

// Only enable in production
const isProduction = import.meta.env.MODE === 'production';
const rollbarToken = import.meta.env.ROLLBAR_CLIENT_ACCESS_TOKEN || import.meta.env.ROLLBAR_ACCESS_TOKEN;
const codeVersion = import.meta.env.PUBLIC_VERCEL_GIT_COMMIT_SHA || 'development';
---

{isProduction && rollbarToken && (
  <script
    define:vars={{ rollbarToken, codeVersion }}
    is:inline
  >
    // @ts-nocheck
    var _rollbarConfig = {
      accessToken: rollbarToken,
      captureUncaught: true,
      captureUnhandledRejections: true,
      payload: {
        environment: "production",
        client: {
          javascript: {
            code_version: codeVersion,
            source_map_enabled: true,
            guess_uncaught_frames: true
          }
        }
      }
    };
  </script>

  <script src="https://cdn.rollbar.com/rollbarjs/refs/tags/v3.0.0-rc.1/rollbar.min.js" crossorigin="anonymous" async is:inline></script>
)}
