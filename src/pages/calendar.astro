---
import BaseLayout from '../layouts/BaseLayout.astro';

const isMobile = Astro.request.headers.get('user-agent')?.toLowerCase().includes('mobile') || false;
---

<BaseLayout title="Calendar">
  <h1>Event Calendar</h1>

  <p>Help us populate this with all the known film events in town! If you would like to be a collaborator on this calendar, contact us in the footer.</p>

  <div class="calendar-container">
    <iframe
      id="calendar-iframe"
      src=""
      frameborder="0"
      scrolling="no">
    </iframe>
  </div>

  <script>
    const desktopSrc = "https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FNew_York&showPrint=0&showCalendars=0&showTz=0&mode=MONTH&src=YXZsZmlsbWdyb3VwQGdtYWlsLmNvbQ&src=ZW4udXNhI2hvbGlkYXlAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&color=%23039be5&color=%230b8043";
    const mobileSrc = "https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FNew_York&showPrint=0&showCalendars=0&mode=AGENDA&src=YXZsZmlsbWdyb3VwQGdtYWlsLmNvbQ&src=ZW4udXNhI2hvbGlkYXlAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&color=%23039be5&color=%230b8043";

    const iframe = document.getElementById('calendar-iframe') as HTMLIFrameElement;
    const isMobile = window.innerWidth <= 768;

    iframe.src = isMobile ? mobileSrc : desktopSrc;

    // Update on resize (debounced)
    let resizeTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const nowMobile = window.innerWidth <= 768;
        const currentSrc = iframe.src;
        const expectedSrc = nowMobile ? mobileSrc : desktopSrc;
        if (currentSrc !== expectedSrc) {
          iframe.src = expectedSrc;
        }
      }, 250);
    });
  </script>

  <style>
    .calendar-container {
      max-width: 100%;
      margin-top: 1.5rem;
    }

    #calendar-iframe {
      display: block;
      max-width: 100%;
      width: 800px;
      height: 600px;
      border: solid 1px #777;
    }

    @media (max-width: 768px) {
      #calendar-iframe {
        width: 100%;
        height: 600px;
      }
    }
  </style>
</BaseLayout>
