---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Film Event Calendar"
  description="Stay up to date with film events, screenings, meetups, and workshops in Asheville, NC. Join the AVL Film community calendar."
  keywords="Asheville film events, AVL Film calendar, film screenings Asheville, filmmaker meetups, film workshops Asheville, NC film community"
>
  <h1>Event Calendar</h1>

  <p class="intro">Help us populate this with all the known film events in town! If you would like to be a collaborator on this calendar, contact us in the footer.</p>

  <div class="calendar-container" id="calendar-container">
    <iframe
      id="calendar-iframe"
      src="https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FNew_York&showPrint=0&showCalendars=0&mode=AGENDA&src=YXZsZmlsbWdyb3VwQGdtYWlsLmNvbQ&src=ZW4udXNhI2hvbGlkYXlAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&color=%23039be5&color=%230b8043">
    </iframe>
  </div>

  <script>
    function setCalendarHeight() {
      const container = document.getElementById('calendar-container');
      const header = document.querySelector('header');
      const main = document.querySelector('main');
      const footer = document.querySelector('footer');

      if (container && header && main && footer) {
        // Get the actual heights
        const headerHeight = header.offsetHeight;
        const footerHeight = footer.offsetHeight;
        const mainPadding = parseInt(window.getComputedStyle(main).paddingTop) +
                           parseInt(window.getComputedStyle(main).paddingBottom);

        // Get the height of content before the container (including all margins)
        const h1 = main.querySelector('h1');
        const intro = main.querySelector('.intro');

        const h1Styles = h1 ? window.getComputedStyle(h1) : null;
        const h1Height = h1 ? h1.offsetHeight +
                             parseInt(h1Styles?.marginTop || '0') +
                             parseInt(h1Styles?.marginBottom || '0') : 0;

        const introStyles = intro ? window.getComputedStyle(intro) : null;
        const introHeight = intro ? intro.offsetHeight +
                                   parseInt(introStyles?.marginTop || '0') +
                                   parseInt(introStyles?.marginBottom || '0') : 0;

        const containerMarginTop = parseInt(window.getComputedStyle(container).marginTop);

        // Calculate available height - subtract everything from viewport height
        const isMobile = window.innerWidth <= 768;
        const buffer = isMobile ? 0 : 20; // Small buffer on desktop for safety
        const availableHeight = window.innerHeight -
                               headerHeight -
                               footerHeight -
                               mainPadding -
                               h1Height -
                               introHeight -
                               containerMarginTop -
                               buffer;

        container.style.height = Math.max(400, availableHeight) + 'px';
      }
    }

    // Set height on load and resize
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setCalendarHeight);
    } else {
      setCalendarHeight();
    }

    let resizeTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(setCalendarHeight, 250);
    });
  </script>

  <style>
    .calendar-container {
      max-width: 100%;
      margin-top: 1.5rem;
      min-height: 400px;
    }

    #calendar-iframe {
      display: block;
      width: 100%;
      height: 100%;
      max-width: 800px;
      border: solid 1px #999;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .calendar-container {
        margin-top: 1rem;
      }

      #calendar-iframe {
        max-width: 100%;
      }
    }
  </style>
</BaseLayout>
